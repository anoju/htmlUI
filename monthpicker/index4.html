<!DOCTYPE html>
<html>
<head>
  <title>monthpicker4</title>
  <style>
    button{
      cursor: pointer;
    }

    .month-picker-container {
      position: relative;
      width: 200px;
      margin-bottom: 10px;
      display: flex;
      gap: 4px;
    }
    
    .month-picker-input {
      flex-grow: 1;
      padding: 8px;
    }
    
    .month-picker-button {
      padding: 8px;
      background: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    
    .month-picker-button:hover {
      background: #e0e0e0;
    }

    .month-picker-dropdown.base {
      position: absolute;
      top: 100%;
      left: 0;
      z-index: 1000;
      margin-top: 4px;
    }
    .month-picker-dropdown.fixed{
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.6);
      display:flex;
      align-items: center;
      justify-content: center;
    }
    .month-picker-inr{
      width: 300px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .month-picker-dropdown .month-picker-inr{
      position:relative;
    }
    
    .month-picker-dropdown .year-selector {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #eee;
      padding-right: 50px;
    }
    
    .month-picker-dropdown button {
      background: none;
      border: none;
      padding: 5px 10px;
    }
    
    .month-picker-dropdown button:disabled {
      opacity: 0.5;
    }
    
    .month-picker-dropdown .months-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 5px;
      padding: 10px;
    }
    
    .month-picker-dropdown .month-btn {
      padding: 5px;
      border: none;
      background: none;
    }
    
    .month-picker-dropdown .month-btn:hover:not(:disabled) {
      background-color: #f0f0f0;
    }
    
    .month-picker-dropdown .month-btn:disabled {
      opacity: 0.5;
    }
    
    .month-picker-dropdown .selected{
      font-weight:bold;
    }
    .month-picker-dropdown .selected:not(:hover) {
      background-color: #428dfc;
      color:#fff;
    }
    .month-picker-dropdown .close-btn{
      position:absolute;
      top:10px;
      right: 10px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- ÏòàÏ†ú ÏûÖÎ†• ÌïÑÎìúÎì§ -->
    <div class="month-picker-container">
      <input type="text" class="month-picker-input" data-min="2022-03" data-max="2024-10">
    </div>
    <div class="month-picker-container">
      <input type="text" class="month-picker-input" data-min="2023-06" data-mobile placeholder="Î™®Î∞îÏùºÏö©">
    </div>
    <div class="month-picker-container">
      <input type="text" class="month-picker-input" data-max="2025-03" data-first placeholder="Ï¥àÍ∏∞Í∞í ÏÑ∏ÌåÖ">
    </div>
    <div class="month-picker-container">
      <input type="text" class="month-picker-input">
    </div>
  </div>

  <script>
const monthPickers = [];
function createMonthPicker(inputElement, options = {}) {
  const months = ["1Ïõî", "2Ïõî", "3Ïõî", "4Ïõî", "5Ïõî", "6Ïõî", "7Ïõî", "8Ïõî", "9Ïõî", "10Ïõî", "11Ïõî", "12Ïõî"];
  let currentDate = new Date();
  let selectedDate = null;
  
  const container = inputElement.parentElement;
  
  // Îã¨Î†• Î≤ÑÌäº ÏÉùÏÑ±
  const calendarButton = document.createElement('button');
  calendarButton.className = 'month-picker-button';
  calendarButton.innerHTML = 'üìÖ';
  container.appendChild(calendarButton);
  
  let dropdown = null;
  
  function parseDateString(dateString) {
    const [year, month] = dateString.split('-').map(Number);
    return new Date(year, month - 1);
  }
  
  function parseOptions() {
    const dataMin = inputElement.getAttribute('data-min');
    const dataMax = inputElement.getAttribute('data-max');
    let mobile = inputElement.getAttribute('data-mobile');
    if(mobile === '') mobile = true;
    let first = inputElement.getAttribute('data-first');
    if(first === '') first = true;

    return {
      minDate: dataMin ? parseDateString(dataMin) : options.minDate,
      maxDate: dataMax ? parseDateString(dataMax) : options.maxDate,
      mobile: mobile ? mobile : options.mobile,
      first: first ? first : options.first,
    };
  }
  
  const pickerOptions = parseOptions();
  console.log(pickerOptions.first)
  if(pickerOptions.first) selectedDate = new Date();

  function createDropdownElement() {
    const dropdownElement = document.createElement('div');
    if(pickerOptions.mobile) dropdownElement.className = 'month-picker-dropdown fixed';
    else dropdownElement.className = 'month-picker-dropdown base';
    dropdownElement.setAttribute('tabindex', '-1');

    const dropdownElementInr = document.createElement('div');
    dropdownElementInr.className = 'month-picker-inr';
    
    const yearSelector = document.createElement('div');
    yearSelector.className = 'year-selector';
    
    const prevBtn = document.createElement('button');
    prevBtn.type = 'button';
    prevBtn.className = 'prev-year';
    prevBtn.textContent = '<';
    
    const yearSpan = document.createElement('span');
    yearSpan.className = 'year-display';
    
    const nextBtn = document.createElement('button');
    nextBtn.type = 'button';
    nextBtn.className = 'next-year';
    nextBtn.textContent = '>';
    
    const closeBtn = document.createElement('button');
    closeBtn.type = 'button';
    closeBtn.className = 'close-btn';
    closeBtn.textContent = 'X';
    
    const monthsDiv = document.createElement('div');
    monthsDiv.className = 'months-grid';
    
    yearSelector.appendChild(prevBtn);
    yearSelector.appendChild(yearSpan);
    yearSelector.appendChild(nextBtn);
    
    dropdownElementInr.appendChild(yearSelector);
    dropdownElementInr.appendChild(monthsDiv);
    dropdownElementInr.appendChild(closeBtn);
    
    dropdownElement.appendChild(dropdownElementInr);
    document.body.appendChild(dropdownElement);
    
    dropdown = dropdownElement;
    return dropdownElement;
  }
  
  function updateValue() {
    if(!selectedDate) return;
    let month = selectedDate.getMonth() + 1;
    if(month < 10) month = '0'+month;
    const selectedYear = selectedDate.getFullYear();
    inputElement.value = `${selectedYear}-${month}`;
  }
  function updateTitle(){
    const year = currentDate.getFullYear();
    if (dropdown) {
      dropdown.querySelector('.year-display').textContent = `${year}ÎÖÑ`;
    }
  }
  
  function isDateInRange(year, month) {
    const date = new Date(year, month);
    const isAfterMin = !pickerOptions.minDate || date >= pickerOptions.minDate;
    const isBeforeMax = !pickerOptions.maxDate || date <= pickerOptions.maxDate;
    return isAfterMin && isBeforeMax;
  }
  
  function updateYearButtons() {
    if (!dropdown) return;
    
    const currentYear = currentDate.getFullYear();
    const prevYearBtn = dropdown.querySelector('.prev-year');
    const nextYearBtn = dropdown.querySelector('.next-year');
    
    if (pickerOptions.minDate) {
      prevYearBtn.disabled = currentYear <= pickerOptions.minDate.getFullYear();
    }
    
    if (pickerOptions.maxDate) {
      nextYearBtn.disabled = currentYear >= pickerOptions.maxDate.getFullYear();
    }
  }
  
  function createMonthButtons() {
    if (!dropdown) return;
    
    const monthsGrid = dropdown.querySelector('.months-grid');
    monthsGrid.innerHTML = '';
    const currentYear = currentDate.getFullYear();
    
    months.forEach((month, index) => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'month-btn';
      btn.textContent = month;
      
      if (selectedDate && currentYear === selectedDate.getFullYear() && index === selectedDate.getMonth()) {
        btn.classList.add('selected');
      }
      
      if (!isDateInRange(currentYear, index)) {
        btn.disabled = true;
      }
      
      btn.addEventListener('click', () => selectMonth(index));
      monthsGrid.appendChild(btn);
    });
  }
  
  function selectMonth(monthIndex) {
    const newDate = new Date(currentDate.getFullYear(), monthIndex);
    
    if (isDateInRange(newDate.getFullYear(), newDate.getMonth())) {
      selectedDate = newDate;
      updateValue();
      removeDropdown(true);
      
      const event = new CustomEvent('monthSelect', {
        detail: {
          year: selectedDate.getFullYear(),
          month: selectedDate.getMonth() + 1
        }
      });
      inputElement.dispatchEvent(event);
    }
  }
  
  function toggleDropdown(e) {
    e.stopPropagation();
    if (dropdown) {
      removeDropdown();
    } else {
      createAndShowDropdown();
    }
  }

  function createAndShowDropdown() {
    dropdown = createDropdownElement();
    if(pickerOptions.first) updateValue();
    updateTitle();
    createMonthButtons();
    updateYearButtons();
    
    if(!pickerOptions.mobile){
      const rect = container.getBoundingClientRect();
      dropdown.style.position = 'absolute';
      dropdown.style.top = `${rect.bottom + window.scrollY}px`;
      dropdown.style.left = `${rect.left + window.scrollX}px`;
    }
    setupFocus(true);
    setupDropdownEvents();
    dropdown.focus();
  }

  function setupFocus(isShow){
    const wrap = document.querySelector('.wrap');
    if(!wrap) return;
    if(isShow){
      if(pickerOptions.mobile) wrap.ariaHidden = true;
      else wrap.inert = true;
    }else{
      if(pickerOptions.mobile) wrap.ariaHidden = null;
      else wrap.inert = false;
    }
  }
  
  function setupDropdownEvents() {
    const prevYearBtn = dropdown.querySelector('.prev-year');
    const nextYearBtn = dropdown.querySelector('.next-year');
    const closeBtn = dropdown.querySelector('.close-btn');
    
    prevYearBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      currentDate.setFullYear(currentDate.getFullYear() - 1);
      // updateValue(); //ÏÑ†ÌÉùÌï¥ÏïºÎßå value ÏÑ∏ÌåÖ
      updateTitle();
      createMonthButtons();
      updateYearButtons();
      dropdown.querySelector('.prev-year').focus();
    });
    
    nextYearBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      currentDate.setFullYear(currentDate.getFullYear() + 1);
      // updateValue(); //ÏÑ†ÌÉùÌï¥ÏïºÎßå value ÏÑ∏ÌåÖ
      updateTitle();
      createMonthButtons();
      updateYearButtons();
      dropdown.querySelector('.next-year').focus();
    });

    closeBtn.addEventListener('click', function(){
      removeDropdown(true);
    });
  }
  
  function removeDropdown(isFocus) {
    if (dropdown) {
      document.body.removeChild(dropdown);
      dropdown = null;
      if(isFocus)calendarButton.focus();
    }
    setupFocus(false);
  }
  
  calendarButton.addEventListener('click', toggleDropdown);
  
  // Ï¥àÍ∏∞Ìôî
  if(pickerOptions.first) updateValue(); //ÏÑ†ÌÉùÌï¥ÏïºÎßå value ÏÑ∏ÌåÖ
  
  // Ïù∏Ïä§ÌÑ¥Ïä§ Í∞ùÏ≤¥ ÏÉùÏÑ±
  const instance = {
    update: function(newOptions) {
      Object.assign(pickerOptions, newOptions);
      updateYearButtons();
      createMonthButtons();
    },
    getValue: function() {
      return {
        year: selectedDate.getFullYear(),
        month: selectedDate.getMonth() + 1
      };
    },
    removeDropdown: removeDropdown,
    container: container,
    getDropdown: function() { return dropdown; }
  };

  // Ïù∏Ïä§ÌÑ¥Ïä§Î•º Ï†ÑÏó≠ Î∞∞Ïó¥Ïóê Ï∂îÍ∞Ä
  monthPickers.push(instance);
  
  return instance;
}

// Ï†ÑÏó≠ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑàÎ•º Ìïú Î≤àÎßå Ï∂îÍ∞Ä
document.addEventListener('click', function(e) {
  monthPickers.forEach(picker => {
    if (!e.target.closest('.month-picker-container') && !e.target.closest('.month-picker-inr') && picker.getDropdown()) {
      picker.removeDropdown();
    }
  });
});

// Î™®Îì† month picker ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞Ìôî
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.month-picker-input').forEach(input => {
    createMonthPicker(input);
  });
});
</script>
</body>
</html>