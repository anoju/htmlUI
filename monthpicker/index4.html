<!DOCTYPE html>
<html>
<head>
  <title>monthpicker4</title>
  <style>
    /* input ì˜ˆì œ */
    button{
      cursor: pointer;
    }
    .monthpicker-container {
      position: relative;
      margin-bottom: 10px;
      display: flex;
      gap: 4px;
      align-items: center;
    }
    .monthpicker {
      width: 140px;
      padding: 8px;
    }
    .blind{
      font-size:0;
      line-height:0;
      color:transparent;
      width:0;
      height:0;
    }
    
    /* ë²„íŠ¼ */
    .month-picker-button {
      padding: 8px;
      background: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    
    .month-picker-button:hover {
      background: #e0e0e0;
    }

    /* ë ˆì´ì–´ */
    .month-picker-wrap.base {
      position: absolute;
      top: 100%;
      left: 0;
      z-index: 1000;
      margin-top: 4px;
    }
    .month-picker-wrap.fixed{
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.6);
      display:flex;
      align-items: center;
      justify-content: center;
    }
    .month-picker-wrap button {
      background: none;
      border: none;
    }
    .month-picker-wrap button:disabled {
      cursor: default;
    }
    .month-picker-inr{
      width: 240px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .month-picker-wrap .month-picker-inr{
      position:relative;
    }
    
    .month-picker-wrap .year-selector {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 40px 10px;
    }
    .month-picker-wrap .year-selector button{
      width: 24px;
      height: 24px;
      overflow:hidden;
      background:url(https://nwww-t.sgic.co.kr/resource/pc/images/common/spr_calendar.png) no-repeat 0 0;
    }
    .month-picker-wrap .year-selector button:disabled {
      opacity: 0.5;
      cursor: default;
    }
    .month-picker-wrap .year-selector .prev-year{
      background-position: 0 -24px;
    }
    .month-picker-wrap .year-selector .next-year{
      background-position:0 -72px;
    }
    .month-picker-wrap .year-display{
      font-size: 20px;
      font-weight: 700;
      color: #050f26;
    }
    
    .month-picker-wrap .months-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 5px;
      padding: 10px;
    }
    
    .month-picker-wrap .month-btn {
      padding: 5px;
      border: none;
      background: none;
      color:#050f26;
      text-align:center;
      border-radius: 3px;
    }
    
    .month-picker-wrap .month-btn:hover:not(:disabled) {
      background-color: #f0f0f0;
    }
    
    .month-picker-wrap .month-btn:disabled {
      color:#8a8a8a;
    }
    
    .month-picker-wrap .selected{
      font-weight:bold;
    }
    .month-picker-wrap .selected:not(:hover) {
      background-color: #4a42b9;
      color:#fff;
    }
    .month-picker-wrap .close-btn{
      display:block;
      position:absolute;
      right:6px;
      top:6px;
      width:20px;
      height:20px;
      background:url(https://nwww-t.sgic.co.kr/resource/pc/images/common/btn_calendar_close.png) no-repeat 50% 50%;
      overflow:hidden;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- ì˜ˆì œ ì…ë ¥ í•„ë“œë“¤ -->
    <div class="monthpicker-container">
      <input type="text" class="monthpicker" data-min="2022-03" data-max="2024-10">
      <span>2022-03 ~ 2024-10</span>
    </div>
    <div class="monthpicker-container">
      <input type="text" class="monthpicker" data-min="2023-06" data-mobile placeholder="ëª¨ë°”ì¼ìš©">
      <span>ëª¨ë°”ì¼ìš©, ìµœì†Œ 2023-06</span>
    </div>
    <div class="monthpicker-container">
      <input type="text" class="monthpicker" data-max="2025-03" data-first placeholder="ì´ˆê¸°ê°’ ì„¸íŒ…">
      <span>ì´ˆê¸°ê°’ ì„¸íŒ…, ìµœì†Œ 2025-03</span>
    </div>
    <div class="monthpicker-container">
      <input type="text" class="monthpicker">
      <button type="button" class="setDataMin">í´ë¦­ì‹œ ì˜µì…˜ ì—…ë°ì´íŠ¸</button>
    </div>
  </div>

  <script>
const monthPickers = [];
function createMonthPicker(inputElement, options = {}) {
  const months = ["1ì›”", "2ì›”", "3ì›”", "4ì›”", "5ì›”", "6ì›”", "7ì›”", "8ì›”", "9ì›”", "10ì›”", "11ì›”", "12ì›”"];
  let currentDate = new Date();
  let selectedDate = null;
  
  const container = inputElement.parentElement;
  
  // ë‹¬ë ¥ ë²„íŠ¼ ìƒì„±
  const calendarButton = document.createElement('button');
  calendarButton.className = 'month-picker-button';
  calendarButton.innerHTML = 'ğŸ“…';
  //container.appendChild(calendarButton);
  container.insertBefore(calendarButton, inputElement.nextSibling);
  
  let dropdown = null;
  
  function parseDateString(dateString) {
    const [year, month] = dateString.split('-').map(Number);
    return new Date(year, month - 1);
  }
  
  function parseOptions() {
    const dataMin = inputElement.getAttribute('data-min');
    const dataMax = inputElement.getAttribute('data-max');
    let mobile = inputElement.getAttribute('data-mobile');
    if(mobile === '') mobile = true;
    let first = inputElement.getAttribute('data-first');
    if(first === '') first = true;

    return {
      minDate: dataMin ? parseDateString(dataMin) : options.minDate,
      maxDate: dataMax ? parseDateString(dataMax) : options.maxDate,
      mobile: mobile ? mobile : options.mobile,
      first: first ? first : options.first,
    };
  }
  
  const pickerOptions = parseOptions();
  if(pickerOptions.first) selectedDate = new Date();

  function createDropdownElement() {
    const dropdownElement = document.createElement('div');
    if(pickerOptions.mobile) dropdownElement.className = 'month-picker-wrap fixed';
    else dropdownElement.className = 'month-picker-wrap base';
    dropdownElement.setAttribute('tabindex', '-1');
  
    const $html = `<div class="month-picker-inr">
      <div class="year-selector">
        <button type="button" class="prev-year"><span class="blind">ì´ì „ë…„ë„</span></button>
        <span class="year-display"></span>
        <button type="button" class="next-year"><span class="blind">ë‹¤ìŒë…„ë„</span></button>
      </div>
      <div class="months-grid"></div>
      <button type="button" class="close-btn"><span class="blind">ë‹«ê¸°</span></button>
    <div>`;
    
    dropdownElement.innerHTML = $html;

    document.body.appendChild(dropdownElement);
    
    dropdown = dropdownElement;
    return dropdownElement;
  }
  
  function updateValue() {
    if(!selectedDate) return;
    let month = selectedDate.getMonth() + 1;
    if(month < 10) month = '0'+month;
    const selectedYear = selectedDate.getFullYear();
    inputElement.value = `${selectedYear}-${month}`;
  }
  function updateTitle(){
    const year = currentDate.getFullYear();
    if (dropdown) {
      dropdown.querySelector('.year-display').textContent = `${year}ë…„`;
    }
  }
  
  function isDateInRange(year, month) {
    const date = new Date(year, month);
    const isAfterMin = !pickerOptions.minDate || date >= pickerOptions.minDate;
    const isBeforeMax = !pickerOptions.maxDate || date <= pickerOptions.maxDate;
    return isAfterMin && isBeforeMax;
  }
  
  function updateYearButtons() {
    if (!dropdown) return;
    
    const currentYear = currentDate.getFullYear();
    const prevYearBtn = dropdown.querySelector('.prev-year');
    const nextYearBtn = dropdown.querySelector('.next-year');
    
    if (pickerOptions.minDate) {
      prevYearBtn.disabled = currentYear <= pickerOptions.minDate.getFullYear();
    }
    
    if (pickerOptions.maxDate) {
      nextYearBtn.disabled = currentYear >= pickerOptions.maxDate.getFullYear();
    }
  }
  
  function createMonthButtons() {
    if (!dropdown) return;
    
    const monthsGrid = dropdown.querySelector('.months-grid');
    monthsGrid.innerHTML = '';
    const currentYear = currentDate.getFullYear();
    
    months.forEach((month, index) => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'month-btn';
      btn.innerHTML = month + '<span class="blind">'+currentYear+'</span>';
            
      if (selectedDate && currentYear === selectedDate.getFullYear() && index === selectedDate.getMonth()) {
        btn.classList.add('selected');
        btn.title = 'ì„ íƒë¨';
      }
      
      if (!isDateInRange(currentYear, index)) {
        btn.disabled = true;
      }

      // const setTitle = `${currentYear}ë…„ ${index+1}ì›”`;
      // if(pickerOptions.mobile) btn.ariaLabel = setTitle;
      // else btn.title = setTitle;
      
      btn.addEventListener('click', () => selectMonth(index));
      monthsGrid.appendChild(btn);
    });
  }
  
  function selectMonth(monthIndex) {
    const newDate = new Date(currentDate.getFullYear(), monthIndex);
    
    if (isDateInRange(newDate.getFullYear(), newDate.getMonth())) {
      selectedDate = newDate;
      updateValue();
      removeDropdown(true);
      
      const event = new CustomEvent('monthSelect', {
        detail: {
          year: selectedDate.getFullYear(),
          month: selectedDate.getMonth() + 1
        }
      });
      inputElement.dispatchEvent(event);
    }
  }
  
  function toggleDropdown(e) {
    e.stopPropagation();
    if (dropdown) {
      removeDropdown();
    } else {
      createAndShowDropdown();
    }
  }

  function createAndShowDropdown() {
    dropdown = createDropdownElement();
    if(pickerOptions.first) updateValue();
    updateTitle();
    createMonthButtons();
    updateYearButtons();
    
    if(!pickerOptions.mobile){
      const rect = container.getBoundingClientRect();
      dropdown.style.position = 'absolute';
      dropdown.style.top = `${rect.bottom + window.scrollY}px`;
      dropdown.style.left = `${rect.left + window.scrollX}px`;
    }
    setFocus(true);
    setDropdownEvents();
    dropdown.focus();
  }

  function setFocus(isShow){
    const wrap = document.querySelector('.wrap');
    if(!wrap) return;
    if(isShow){
      if(pickerOptions.mobile) wrap.ariaHidden = true;
      else wrap.inert = true;
    }else{
      if(pickerOptions.mobile) wrap.ariaHidden = null;
      else wrap.inert = false;
    }
  }
  
  function setDropdownEvents() {
    const prevYearBtn = dropdown.querySelector('.prev-year');
    const nextYearBtn = dropdown.querySelector('.next-year');
    const closeBtn = dropdown.querySelector('.close-btn');
    
    prevYearBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      currentDate.setFullYear(currentDate.getFullYear() - 1);
      // updateValue(); //ì„ íƒí•´ì•¼ë§Œ value ì„¸íŒ…
      updateTitle();
      createMonthButtons();
      updateYearButtons();
      dropdown.querySelector('.prev-year').focus();
    });
    
    nextYearBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      currentDate.setFullYear(currentDate.getFullYear() + 1);
      // updateValue(); //ì„ íƒí•´ì•¼ë§Œ value ì„¸íŒ…
      updateTitle();
      createMonthButtons();
      updateYearButtons();
      dropdown.querySelector('.next-year').focus();
    });

    closeBtn.addEventListener('click', function(){
      removeDropdown(true);
    });
  }
  
  function removeDropdown(isFocus) {
    if (dropdown) {
      document.body.removeChild(dropdown);
      dropdown = null;
      if(isFocus)calendarButton.focus();
    }
    setFocus(false);
  }
  
  calendarButton.addEventListener('click', toggleDropdown);
  
  // ì´ˆê¸°í™”
  if(pickerOptions.first) updateValue(); //ì„ íƒí•´ì•¼ë§Œ value ì„¸íŒ…

  // ì—…ë°ì´íŠ¸
  function updateOptions(newOptions = {}) {
    if (newOptions.minDate) {
      pickerOptions.minDate = parseDateString(newOptions.minDate);
      inputElement.setAttribute('data-min', newOptions.minDate);
    }
    if (newOptions.maxDate) {
      pickerOptions.maxDate = parseDateString(newOptions.maxDate);
      inputElement.setAttribute('data-max', newOptions.maxDate);
    }
    if (newOptions.mobile !== undefined) {
      pickerOptions.mobile = newOptions.mobile;
    }

    // í˜„ì¬ ë‚ ì§œì™€ ì„ íƒëœ ë‚ ì§œê°€ ìƒˆë¡œìš´ ë²”ìœ„ ë‚´ì— ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì¡°ì •
    if (currentDate < pickerOptions.minDate) {
      currentDate = new Date(pickerOptions.minDate);
    } else if (currentDate > pickerOptions.maxDate) {
      currentDate = new Date(pickerOptions.maxDate);
    }

    if (selectedDate && (selectedDate < pickerOptions.minDate || selectedDate > pickerOptions.maxDate)) {
      selectedDate = new Date(currentDate);
      updateValue();
    }

    updateYearButtons();
    createMonthButtons();
    updateTitle();
  }
  
  // ì¸ìŠ¤í„´ìŠ¤ ê°ì²´ ìƒì„±
  const instance = {
    update: updateOptions,
    getValue: function() {
      return {
        year: selectedDate.getFullYear(),
        month: selectedDate.getMonth() + 1
      };
    },
    removeDropdown: removeDropdown,
    container: container,
    getDropdown: function() { return dropdown; }
  };

  // ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì „ì—­ ë°°ì—´ì— ì¶”ê°€
  monthPickers.push(instance);
  
  return instance;
}

// ì „ì—­ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ í•œ ë²ˆë§Œ ì¶”ê°€
document.addEventListener('click', function(e) {
  monthPickers.forEach(picker => {
    if (!e.target.closest('.month-picker-inr') && picker.getDropdown()) {
      picker.removeDropdown();
    }
  });
});

// ëª¨ë“  month picker ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.monthpicker').forEach(input => {
    createMonthPicker(input);
  });


  //í…ŒìŠ¤íŠ¸ìš©
  document.querySelector('.setDataMin').addEventListener('click', (e) => {
    const  picker = monthPickers[3];
    picker.update({
      minDate: '2025-02',
      maxDate: '2025-11',
      mobile: true
    });
  });
});
</script>
</body>
</html>