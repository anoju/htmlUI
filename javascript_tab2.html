<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>javascript_tab2</title>
	<link rel="stylesheet" href="css/tab2.min.css">
</head>
<body>

	<div class="tabs">
		<div class="tab-menu">
			<div class="tab-line"></div>
			<ul class="tab-list">
				<li class="tab-item"><a href="#" class="tab">탭1</a></li>
				<li class="tab-item"><a href="#" class="tab">탭2</a></li>
				<li class="tab-item"><a href="#" class="tab">탭3</a></li>
			</ul>
		</div>
		<div class="tab-contents">
			<div class="tab-panel" style="background:skyblue;">
				탭내용1<br>
				탭내용1<br>
				탭내용1<br>
				탭내용1<br>
				탭내용1<br>
				탭내용1<br>
				탭내용1<br>
				탭내용1
			</div>
			<div class="tab-panel" style="background:goldenrod;">
				탭내용2<br>
				탭내용2<br>
				탭내용2<br>
				탭내용2
			</div>
			<div class="tab-panel" style="background:purple;color:#fff;">
				탭내용3<br>
				탭내용3<br>
				탭내용3<br>
				탭내용3<br>
				탭내용3<br>
				탭내용3
			</div>
		</div>
	</div>
	<br>
	<br>
	<br>
	<div class="tabs">
		<div class="tab-menu">
			<div class="tab-line"></div>
			<ul class="tab-list">
				<li class="tab-item"><a href="#" class="tab">탭1</a></li>
				<li class="tab-item"><a href="#" class="tab">탭2</a></li>
				<li class="tab-item tab-active"><a href="#" class="tab">탭3</a></li>
				<li class="tab-item"><a href="#" class="tab">탭4</a></li>
				<li class="tab-item"><a href="#" class="tab">탭5</a></li>
				<li class="tab-item"><a href="#" class="tab">탭6</a></li>
				<li class="tab-item"><a href="#" class="tab">탭7</a></li>
				<li class="tab-item"><a href="#" class="tab">탭8</a></li>
				<li class="tab-item"><a href="#" class="tab">탭9</a></li>
				<li class="tab-item"><a href="#" class="tab">탭10</a></li>
			</ul>
		</div>
		<div class="tab-contents">
			<div class="tab-panel" style="background:skyblue;">
				탭내용1<br>
				탭내용1<br>
				탭내용1<br>
				탭내용1<br>
				탭내용1<br>
				탭내용1<br>
				탭내용1<br>
				탭내용1
			</div>
			<div class="tab-panel" style="background:goldenrod;">
				탭내용2<br>
				탭내용2<br>
				탭내용2<br>
				탭내용2
			</div>
			<div class="tab-panel" style="background:purple;color:#fff;">
				탭내용3<br>
				탭내용3<br>
				탭내용3<br>
				탭내용3<br>
				탭내용3<br>
				탭내용3
			</div>
			<div class="tab-panel" style="background:skyblue;">
				탭내용4<br>
				탭내용4<br>
				탭내용4<br>
				탭내용4<br>
				탭내용4<br>
				탭내용4<br>
				탭내용4<br>
				탭내용4<br>
				탭내용4<br>
				탭내용4<br>
				탭내용4
			</div>
			<div class="tab-panel" style="background:goldenrod;">
				탭내용5<br>
				탭내용5<br>
				탭내용5<br>
				탭내용5<br>
				탭내용5<br>
				탭내용5<br>
				탭내용5<br>
				탭내용5<br>
				탭내용5
			</div>
			<div class="tab-panel" style="background:purple;color:#fff;">
				탭내용6<br>
				탭내용6<br>
				탭내용6<br>
				탭내용6<br>
				탭내용6<br>
				탭내용6<br>
				탭내용6<br>
				탭내용6<br>
				탭내용6<br>
				탭내용6<br>
				탭내용6<br>
				탭내용6<br>
				탭내용6<br>
				탭내용6
			</div>
			<div class="tab-panel" style="background:skyblue;">
				탭내용7<br>
				탭내용7<br>
				탭내용7<br>
				탭내용7<br>
				탭내용7<br>
				탭내용7<br>
				탭내용7<br>
				탭내용7<br>
				탭내용7<br>
				탭내용7<br>
				탭내용7<br>
				탭내용7<br>
				탭내용7<br>
				탭내용7<br>
				탭내용7<br>
				탭내용7
			</div>
			<div class="tab-panel" style="background:goldenrod;">
				탭내용8<br>
				탭내용8<br>
				탭내용8<br>
				탭내용8
			</div>
			<div class="tab-panel" style="background:purple;color:#fff;">
				탭내용9<br>
				탭내용9<br>
				탭내용9<br>
				탭내용9<br>
				탭내용9<br>
				탭내용9
			</div>
			<div class="tab-panel" style="background:skyblue;">
				탭내용10<br>
				탭내용10<br>
				탭내용10<br>
				탭내용10<br>
				탭내용10<br>
				탭내용10<br>
				탭내용10<br>
				탭내용10
			</div>
			<div class="tab-panel" style="background:goldenrod;">
				탭내용2<br>
				탭내용2<br>
				탭내용2<br>
				탭내용2
			</div>
		</div>
	</div>
  
<script>
// 형제 엘리먼트 구하기
const getSiblings = element => {
	const siblings = [];
	if (!element.parentNode) return siblings;
	let sibling = element.parentNode.firstChild;
	while (sibling) {
		if (sibling.nodeType === 1 && sibling !== element) siblings.push(sibling);
		sibling = sibling.nextSibling;
	}
	return siblings;
}

// 위치값 구하기
const getOffset = element => {
	let $el = element;
	let $elX = 0;
	let $elY = 0;
	while ($el && !Number.isNaN($el.offsetLeft) && !Number.isNaN($el.offsetTop)) {
		let $style = window.getComputedStyle($el);
		const $matrix = new WebKitCSSMatrix($style.transform);
		$elX += $el.offsetLeft;
		$elY += $el.offsetTop;
		$el = $el.offsetParent;
		if($el !== null) {
			$style = window.getComputedStyle($el);
			$elX += parseInt($style.borderLeftWidth);
			$elY += parseInt($style.borderTopWidth);
		}
	}
	return {left: $elX, top:$elY}
}

//scroll
const targetScroll = (element, option, duration = 300, callback) => {
	if(option === undefined || (option.left === undefined && option.top === undefined)) return;
	const $el = (element === window || element === 'window') ? (document.documentElement || document.body.parentNode || document.body) : element;
	const $isLeft = option.left !== undefined;
	const $isTop = option.top !== undefined;

	const easeInOutQuad = function (t, b, c, d) {
		t /= d/2;
		if (t < 1) {
			return c/2*t*t + b
		}
		t--;
		return -c/2 * (t*(t-2) - 1) + b;
	};

	const requestAnimFrame = (() => {
		return  window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function( callback ){ window.setTimeout(callback, 1000 / 60); };
	})();

	const sclMove = (leftVal, topValue) => {
		if(leftVal !== null) $el.scrollLeft = leftVal;
		if(topValue !== null) $el.scrollTop = topValue;
	};

	const startLeft = $el.scrollLeft;
	const changeLeft = $isLeft ? option.left - startLeft : null;
	const startTop = $el.scrollTop;
	const changeTop = $isTop ? option.top - startTop : null;

	let	currentTime = 0;
	const increment = 20;

	var animateScroll = function() {
		currentTime += increment;
		var leftVal = changeLeft === null ? null : easeInOutQuad(currentTime, startLeft, changeLeft, duration);
		var topVal = changeTop === null ? null : easeInOutQuad(currentTime, startTop, changeTop, duration);
		sclMove(leftVal, topVal);
		if (currentTime < duration) {
			requestAnimFrame(animateScroll);
		} else {
			if (callback && typeof(callback) === 'function') {
				callback();
			}
		}
	};
	animateScroll();
}

//탭
const tabUI = (element, option) => {
	//default option
	let menuClass = 'tab-menu';
	let listClass = 'tab-list';
	let itemClass = 'tab-item';
	let btnClass = 'tab';
	let activeClass = 'tab-active';
	let contentsClass = 'tab-contents';
	let panelClass = 'tab-panel';
	let activePanelClass = 'tab-panel-active';
	let enterPanelClass = 'tab-panel-enter';
	let leavePanelClass = 'tab-panel-leave';
	let panelInLeftClass = 'panel-in-left';
	let panelInRightClass = 'panel-in-right';
	let lineClass = 'tab-line';
	let lineMovingClass = 'line-moving';

	//change option
	if(option){
		if(option.menuClass !== undefined) menuClass = option.menuClass;
		if(option.listClass !== undefined) listClass = option.listClass;
		if(option.itemClass !== undefined) itemClass = option.itemClass;
		if(option.btnClass !== undefined) btnClass = option.btnClass;
		if(option.activeClass !== undefined) activeClass = option.activeClass;
		if(option.contentsClass !== undefined) contentsClass = option.contentsClass;
		if(option.panelClass !== undefined) panelClass = option.panelClass;
		if(option.activePanelClass !== undefined) activePanelClass = option.activePanelClass;
		if(option.enterPanelClass !== undefined) enterPanelClass = option.enterPanelClass;
		if(option.leavePanelClass !== undefined) leavePanelClass = option.leavePanelClass;
		if(option.panelInLeftClass !== undefined) panelInLeftClass = option.panelInLeftClass;
		if(option.panelInRightClass !== undefined) panelInRightClass = option.panelInRightClass;
		if(option.lineClass !== undefined) lineClass = option.lineClass;
		if(option.lineMovingClass !== undefined) lineMovingClass = option.lineMovingClass;
	}

	const getPositionLeft = element => {
		const $menu = element.closest('.'+menuClass);
		return getOffset(element).left - getOffset($menu).left;
	}

	// line animation
	const lineMove = wrap => {
		const $line = wrap.querySelector('.'+lineClass);
		if(!$line) return;
		wrap.classList.add(lineMovingClass);
		const $active = wrap.querySelector('.'+itemClass+'.'+activeClass);
		const $activeW = $active.offsetWidth;
		const $activeL = getPositionLeft($active);
		$line.style.width = $activeW+'px';
		$line.style.left = $activeL+'px';
		const transitionendEvt = () => {
			wrap.classList.remove(lineMovingClass);
			$line.removeEventListener('transitionend',transitionendEvt);
		};
		$line.addEventListener('transitionend',transitionendEvt);
	};

	// active center scroll animation
	const activeCenter = wrap => {
		const $active = wrap.querySelector('.'+itemClass+'.'+activeClass);
		const $wrapW = wrap.offsetWidth;
		const $activeW = $active.offsetWidth;
		const $activeL = getPositionLeft($active);
		const $leftVal = $activeL + $activeW/2 - $wrapW/2;
		targetScroll(wrap,{left:$leftVal});
	}

	// ready
	const readyEvt = el => {
		const $el = el;
		if(!$el) return;
		const $tabsIndex = document.querySelectorAll('[data-tab]').length;
		$el.dataset.tab = $tabsIndex;
		const $menu = $el.querySelector('.'+menuClass);
		const $list = $menu.querySelector('.'+listClass);
		const $items = $list.querySelectorAll('.'+itemClass);
		const $contents = $el.querySelector('.'+contentsClass);
		const $panels = $contents.querySelectorAll('.'+panelClass);
		const $itemsActive = $list.querySelector('.'+itemClass+'.'+activeClass);

		$panels.forEach(panel => {
			panel.setAttribute('role',' tabpanel');
			panel.setAttribute('aria-expanded',' false');
		});

		$items.forEach((item, itemIndex) => {
			item.setAttribute('role','presentation');
			const $isOpen = !!item.classList.contains(activeClass);
			const $btn = item.querySelector('.'+btnClass);
			if(!$btn) return;
			$btn.setAttribute('role','tab');
			const $btnID = $btn.getAttribute('id') ? $btn.getAttribute('id') : 'tab_btn_'+$tabsIndex+'_'+itemIndex;
			if(!$btn.getAttribute('id')) $btn.setAttribute('id',$btnID);
			const $panel = $panels[itemIndex];
			if(!$panel){
				item.style.display = 'none';
			}else{
				const $panelID = $panel.getAttribute('id') ? $panel.getAttribute('id') : 'tab_panel_'+$tabsIndex+'_'+itemIndex;
				if($btn.tagName === 'A') $btn.setAttribute('href', '#'+$btnID);
				$btn.setAttribute('aria-selected', 'false');
				$btn.setAttribute('aria-controls', $panelID);
				$panel.setAttribute('aria-labelledby', $btnID);

				if ($isOpen || (!$itemsActive && itemIndex === 0)) {
					item.classList.add(activeClass);
					$btn.setAttribute('aria-selected', 'true');
					$panel.classList.add(activePanelClass);
					$panel.setAttribute('aria-expanded', 'true');
					$contents.style.height = $panel.offsetHeight + 'px';
				}
			}
		});

		lineMove($menu);
		activeCenter($menu);
	};

	// active
	const activeEvt = (wrap, index, isTouch = false) => {
		const $menu = wrap;
		let $idx = index;
		const $list = $menu.querySelector('.'+listClass);
		const $items = $list.querySelectorAll('.'+itemClass);
		if($idx >= $items.length){
			$idx = 0;
		}else if($idx < 0){
			$idx = $items.length - 1;
		}
		const $item = $items[$idx];
		const $btn = $item.querySelector('.'+btnClass);
		const $contents = $menu.parentNode.querySelector('.'+contentsClass);
		const $panels = $contents.querySelectorAll('.'+panelClass);
		const $panel = $panels[$idx];
		const $itemsActive = $list.querySelector('.'+itemClass+'.'+activeClass);
		const $beforeIdx = Array.from($items).indexOf($itemsActive);
		const $beforePanel = $panels[$beforeIdx];
		if(!$panel || $idx === $beforeIdx) return;
		$items.forEach(item => {
			item.classList.remove(activeClass);
			item.querySelector('.'+btnClass).setAttribute('aria-selected', 'false');
		});
		$item.classList.add(activeClass);
		$btn.setAttribute('aria-selected', 'true');
		if(isTouch && (($idx === 0 && $beforeIdx === $items.length - 1) || ($beforeIdx === 0 && $idx === $items.length - 1))){
			if($idx === 0 && $beforeIdx === $items.length - 1){
				$contents.classList.add(panelInRightClass);
			}else if($beforeIdx === 0 && $idx === $items.length - 1){
				$contents.classList.add(panelInLeftClass);
			}
		}else if($beforeIdx < $idx){
			$contents.classList.add(panelInRightClass);
		}else{
			$contents.classList.add(panelInLeftClass);
		}
		$panels.forEach(panel => {
			panel.setAttribute('aria-expanded', 'false');
			panel.classList.remove(activePanelClass, enterPanelClass, leavePanelClass);
		});
		$panel.setAttribute('aria-expanded', 'true');
		$panel.classList.add(activePanelClass, enterPanelClass);
		$contents.style.height = $panel.offsetHeight + 'px';
		$beforePanel.classList.add(leavePanelClass);
		const animationendEvt = () => {
			$contents.classList.remove(panelInRightClass, panelInLeftClass);
			$panel.classList.remove(enterPanelClass);
			$beforePanel.classList.remove(leavePanelClass);
			$panel.removeEventListener('animationend',animationendEvt);
		}
		$panel.addEventListener('animationend',animationendEvt);

		lineMove($menu);
		activeCenter($menu);
	};


	// click
	const clickEvt = e => {
		const $target = e.target.closest('.'+btnClass) ? e.target.closest('.'+btnClass) : e.target;
		if($target.classList.contains(btnClass)){
			e.preventDefault();
			const $menu = $target.closest('.'+menuClass);
			const $items = $menu.querySelectorAll('.'+itemClass);
			const $item = $target.closest('.'+itemClass);
			const $idx = Array.from($items).indexOf($item);
			activeEvt($menu, $idx);
		}
	};

	// touch
	let $startTouchX = 0;
	let $startTouchY = 0;
	let $endTouchX = 0;
	let $endTouchY = 0;
	const gapX = 80;
	const gapY = 30;
	let $isTargetScl = false;
	const touchEvt = e => {
		if(e.type !== 'touchstart' && e.type !== 'touchmove' && e.type !== 'touchend') return;
		let $target = e.target;
		const $contents = $target.closest('.'+contentsClass) ? $target.closest('.'+contentsClass) : $target;
		const $menu = $contents.parentNode.querySelector('.'+menuClass);
		const $items = $menu.querySelectorAll('.'+itemClass);
		const $active = $menu.querySelector('.'+itemClass+'.'+activeClass);
		let $idx = Array.from($items).indexOf($active);

		if(e.type === 'touchstart'){
			$startTouchX = e.touches[0].clientX;
			$startTouchY = e.touches[0].clientY;
			while (!$target.classList.contains(contentsClass) && !$isTargetScl){
				if($target.scrollWidth > $target.offsetWidth) $isTargetScl = true;
				$target = $target.parentNode;
			}
		}

		if(e.type === 'touchend'){
			$endTouchX = e.changedTouches[0].clientX;
			$endTouchY = e.changedTouches[0].clientY;
			//console.log($startTouchX, $endTouchX,$startTouchY, $endTouchY, $idx)
			if(!$isTargetScl && Math.abs($endTouchX - $startTouchX) > gapX && Math.abs($endTouchY - $startTouchY) < gapY){
				if($endTouchX - $startTouchX > gapX){
					$idx -= 1;
				}else if($startTouchX - $endTouchX > gapX){
					$idx += 1;
				}
				//console.log('activeEvt',$idx)
				activeEvt($menu, $idx, true);
			}
			$isTargetScl = false;
		}
	};

	//resize
	const resizeEvt = () => {
		const $menu = document.querySelectorAll('.'+menuClass);
		if($menu.length){
			$menu.forEach(el => {
				lineMove(el);
			});
		}
		const $contents = document.querySelectorAll('.'+contentsClass);
		if($contents.length){
			$contents.forEach(el => {
				const $activePanel = el.querySelector('.'+activePanelClass);
				if($activePanel) el.style.height = $activePanel.offsetHeight + 'px';
			});
		}
	}

	//init
	if (element) {
		readyEvt(element);
		element.removeEventListener('click', clickEvt);
		element.addEventListener('click', clickEvt);

		const $contents = element.querySelector('.'+contentsClass);
		if($contents){
			$contents.removeEventListener('touchstart', touchEvt);
			$contents.removeEventListener('touchend', touchEvt);
			$contents.addEventListener('touchstart', touchEvt);
			$contents.addEventListener('touchend', touchEvt);
		}
	}else{
		return;
	}
	window.removeEventListener('resize', resizeEvt);
	window.addEventListener('resize', resizeEvt);
}

// 탭 실행
const $tabs = document.querySelectorAll('.tabs');
$tabs.forEach(el => {
	tabUI(el);
});
</script>
</body>
</html>