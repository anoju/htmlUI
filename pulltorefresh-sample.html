<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pull to Refresh Sample</title>
    <!-- pulltorefreshjs CDN -->
    <script src="https://cdn.jsdelivr.net/npm/pulltorefreshjs@0.1.22/dist/index.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            overflow-x: hidden;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }

        .header {
            background: #0046ff;
            color: white;
            padding: 16px;
            text-align: center;
            font-size: 18px;
            font-weight: 500;
        }

        .content {
            padding: 20px;
        }

        .item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .item-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
            color: #333;
        }

        .item-desc {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }

        .item-time {
            font-size: 12px;
            color: #999;
            margin-top: 8px;
        }

        /* PullToRefresh ìŠ¤íƒ€ì¼ */
        .sv-pulltorefresh--ptr {
            box-shadow: none !important;
        }

        /* ìƒˆë¡œê³ ì¹¨ ì§„í–‰ ì¤‘ */
        .sv-pulltorefresh--ptr.sv-pulltorefresh--refresh {
            background: #f5f5f5;
        }

        /* ìƒˆë¡œê³ ì¹¨ ì¤€ë¹„ */
        .sv-pulltorefresh--ptr.sv-pulltorefresh--release {
            background: #f5f5f5;
        }

        .sv-pulltorefresh--content {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .sv-pulltorefresh--icon {
            display: inline-block;
            vertical-align: top;
            margin: 0 4px 0 0;
            width: 16px;
            height: 16px;
            color: #333;
        }

        .sv-pulltorefresh--icon .icon {
            display: block;
            width: 16px;
            height: 16px;
            animation: refresh 1s 0.2s linear infinite;
        }

        .sv-pulltorefresh--icon .icon svg {
            width: 16px;
            height: 16px;
        }

        .sv-pulltorefresh--text {
            margin-top: 0;
            font-size: 14px;
            font-weight: 500;
            color: #666;
        }

        /* Pull ìƒíƒœì¼ ë•ŒëŠ” ì• ë‹ˆë©”ì´ì…˜ ë©ˆì¶¤ */
        .sv-pulltorefresh--ptr.sv-pulltorefresh--pull .sv-pulltorefresh--content .sv-pulltorefresh--icon .icon {
            animation-play-state: paused;
        }

        @keyframes refresh {
            to {
                transform: rotate(360deg);
            }
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .info-box p {
            font-size: 14px;
            color: #1976d2;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            Pull to Refresh Sample
        </div>

        <div id="PullToRefreshContainer">
            <div class="content">
                <div class="info-box">
                    <p>ğŸ‘‡ í™”ë©´ì„ ì•„ë˜ë¡œ ë‹¹ê²¨ì„œ ìƒˆë¡œê³ ì¹¨ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>

                <div id="itemList">
                    <!-- ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        /**
         * Pull to Refresh ì´ˆê¸°í™” í•¨ìˆ˜
         * @param {string|HTMLElement} element - ëŒ€ìƒ ì—˜ë¦¬ë¨¼íŠ¸ (ì„ íƒì ë˜ëŠ” DOM ê°ì²´)
         * @param {Object} options - ì˜µì…˜ ì„¤ì •
         * @param {string} options.pullMessage - Pull ë©”ì‹œì§€
         * @param {string} options.releaseMessage - Release ë©”ì‹œì§€
         * @param {string} options.refreshMessage - Refresh ë©”ì‹œì§€
         * @param {number} options.refreshTimeout - ìƒˆë¡œê³ ì¹¨ íƒ€ì„ì•„ì›ƒ (ms)
         * @param {number} options.distThreshold - ìƒˆë¡œê³ ì¹¨ íŠ¸ë¦¬ê±° ê±°ë¦¬
         * @param {number} options.yPosition - Y í¬ì§€ì…˜ ì²´í¬ ê¸°ì¤€
         * @param {Function} callbackEvent - ìƒˆë¡œê³ ì¹¨ ì½œë°± í•¨ìˆ˜ (close í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ìŒ)
         * @returns {Object} - PullToRefresh ì¸ìŠ¤í„´ìŠ¤ ë° ì œì–´ í•¨ìˆ˜
         */
        function pullToRefreshInit(element, options = {}, callbackEvent) {
            // ê¸°ë³¸ ì˜µì…˜ ì„¤ì •
            const defaultOptions = {
                pullMessage: 'ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆì–´ìš”.',
                releaseMessage: 'ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆì–´ìš”.',
                refreshMessage: 'ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆì–´ìš”.',
                refreshTimeout: 5000,
                distThreshold: 60,
                yPosition: 0
            };

            // ì˜µì…˜ ë³‘í•©
            const config = { ...defaultOptions, ...options };

            // ì•„ì´ì½˜ SVG
            const svg = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M13.9676 8.96757H19.6313V3.30381H21.0317V10.368H13.9676V8.96757Z" fill="currentColor"/>
                <path d="M10.1285 3.19632C12.2245 2.75086 14.4105 3.0685 16.2936 4.09085C18.1768 5.11334 19.634 6.77394 20.402 8.77445L19.0944 9.2764C18.4458 7.5871 17.2158 6.18475 15.6256 5.32132C14.0354 4.45795 12.1895 4.19022 10.4196 4.56644C8.64966 4.94265 7.07193 5.93762 5.97034 7.37308C4.8688 8.80864 4.31517 10.5905 4.40979 12.3975C4.5045 14.2046 5.24131 15.9189 6.48694 17.2315C7.73257 18.5441 9.40605 19.3695 11.2057 19.5586C13.0051 19.7476 14.8132 19.2885 16.3043 18.2637C17.7957 17.2387 18.8721 15.7148 19.3405 13.9668L20.693 14.3291C20.1384 16.399 18.8633 18.2033 17.0973 19.417C15.3314 20.6307 13.1903 21.1751 11.0592 20.9512C8.92806 20.7272 6.9464 19.7497 5.47132 18.1953C3.99622 16.6409 3.12448 14.6107 3.01233 12.4707C2.90027 10.331 3.55476 8.22146 4.85901 6.52152C6.16355 4.82142 8.03244 3.64186 10.1285 3.19632Z" fill="currentColor"/>
            </svg>`;

            // DOM ìƒì„± í•¨ìˆ˜
            function generateDom(str) {
                return `<span class="txt">${str}</span>`;
            }

            // ì—˜ë¦¬ë¨¼íŠ¸ ì„ íƒì ì²˜ë¦¬
            const targetElement = typeof element === 'string' ? element : element;

            // ë‚´ë¶€ ìƒíƒœ ê´€ë¦¬
            let ptrInstance = null;
            let timeout = null;

            // Timeout ì •ë¦¬ í•¨ìˆ˜
            function cleanupTimeout() {
                if (timeout) {
                    clearTimeout(timeout);
                    timeout = null;
                }
            }

            // PullToRefresh ì´ˆê¸°í™”
            ptrInstance = PullToRefresh.init({
                mainElement: targetElement,
                triggerElement: targetElement,
                distThreshold: config.distThreshold,
                refreshTimeout: 300,
                instructionsPullToRefresh: generateDom(config.pullMessage),
                instructionsReleaseToRefresh: generateDom(config.refreshMessage),
                instructionsRefreshing: generateDom(config.releaseMessage),
                ptrElement: '.sv-pulltorefresh',
                classPrefix: 'sv-pulltorefresh--',
                iconArrow: '<span class="icon">' + svg + '</span>',
                iconRefreshing: '<span class="icon">' + svg + '</span>',

                // ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰ í•¨ìˆ˜
                onRefresh: function(closeRefresh) {
                    console.log('Refreshing...');

                    // íƒ€ì„ì•„ì›ƒ ì„¤ì •
                    timeout = setTimeout(function() {
                        cleanupTimeout();
                        closeRefresh();
                    }, config.refreshTimeout);

                    // close í•¨ìˆ˜ ë˜í•‘
                    const close = function() {
                        cleanupTimeout();
                        closeRefresh();
                    };

                    // ì½œë°± ì‹¤í–‰
                    if (typeof callbackEvent === 'function') {
                        callbackEvent(close);
                    } else {
                        close();
                    }
                },

                // ì´ˆê¸°í™” ì½œë°±
                onInit: function() {
                    console.log('PullToRefresh initialized');
                },

                // ìƒˆë¡œê³ ì¹¨ ê°€ëŠ¥ ì—¬ë¶€ ì²´í¬
                shouldPullToRefresh: function() {
                    const scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
                    return scrollTop <= (config.yPosition || 50);
                }
            });

            // ì¸ìŠ¤í„´ìŠ¤ ì œì–´ í•¨ìˆ˜ ë°˜í™˜
            return {
                instance: ptrInstance,
                destroy: function() {
                    if (ptrInstance) {
                        ptrInstance.destroy();
                        ptrInstance = null;
                    }
                    cleanupTimeout();
                },
                getConfig: function() {
                    return config;
                }
            };
        }

        // ============================================
        // ì‚¬ìš© ì˜ˆì œ
        // ============================================

        // ìƒ˜í”Œ ë°ì´í„° ìƒì„±
        function generateItems(count = 10) {
            const items = [];
            const now = Date.now();

            for (let i = 0; i < count; i++) {
                items.push({
                    id: i + 1,
                    title: `ì•„ì´í…œ ${i + 1}`,
                    description: `ì´ê²ƒì€ ${i + 1}ë²ˆì§¸ ìƒ˜í”Œ ì•„ì´í…œì…ë‹ˆë‹¤. Pull to Refreshë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ ë”ë¯¸ ë°ì´í„°ì…ë‹ˆë‹¤.`,
                    time: new Date(now - i * 3600000).toLocaleString('ko-KR')
                });
            }

            return items;
        }

        // ì•„ì´í…œ ë Œë”ë§
        function renderItems(items) {
            const itemList = document.getElementById('itemList');
            itemList.innerHTML = items.map(item => `
                <div class="item">
                    <div class="item-title">${item.title}</div>
                    <div class="item-desc">${item.description}</div>
                    <div class="item-time">${item.time}</div>
                </div>
            `).join('');
        }

        // ì´ˆê¸° ì•„ì´í…œ ë Œë”ë§
        renderItems(generateItems());

        // Pull to Refresh ì´ˆê¸°í™” - í•¨ìˆ˜ ì‚¬ìš© ì˜ˆì œ
        const ptrController = pullToRefreshInit(
            '#PullToRefreshContainer',
            {
                pullMessage: 'ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆì–´ìš”.',
                releaseMessage: 'ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆì–´ìš”.',
                refreshMessage: 'ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆì–´ìš”.',
                refreshTimeout: 5000,
                distThreshold: 60,
                yPosition: 0
            },
            function(close) {
                // ìƒˆë¡œê³ ì¹¨ ì½œë°±
                console.log('Refresh callback executed!');

                // ì‹¤ì œ ë°ì´í„° ë¡œë“œ ì‹œë®¬ë ˆì´ì…˜ (2ì´ˆ í›„ ì™„ë£Œ)
                setTimeout(function() {
                    // ìƒˆë¡œìš´ ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸
                    const newItems = generateItems();
                    renderItems(newItems);

                    console.log('Refresh completed!');

                    // ìƒˆë¡œê³ ì¹¨ ì¢…ë£Œ
                    close();
                }, 2000);
            }
        );

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
        window.addEventListener('beforeunload', function() {
            ptrController.destroy();
        });
    </script>
</body>
</html>
