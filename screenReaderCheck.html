<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>ëª¨ë°”ì¼ ìŠ¤í¬ë¦° ë¦¬ë” ê°ì§€</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  padding: 20px;
  line-height: 1.6;
}

.console {
  background: #f5f5f5;
  padding: 15px;
  border-radius: 8px;
  margin: 20px 0;
  border-left: 4px solid #007acc;
}

.score {
  font-weight: bold;
  color: #007acc;
}

.test-button {
  background: #007acc;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 6px;
  font-size: 16px;
  cursor: pointer;
  margin: 10px 0;
}

.test-button:hover {
  background: #005a9e;
}

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

.test-aria {
  width: 1px;
  height: 1px;
  opacity: 0;
  overflow: hidden;
  position: absolute;
}
</style>
</head>

<body>
<h1>ëª¨ë°”ì¼ ìŠ¤í¬ë¦° ë¦¬ë” ê°ì§€ í…ŒìŠ¤íŠ¸</h1>

<div class="console" id="console">
  <p>ê°ì§€ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</p>
</div>

<button class="test-button" onclick="runFullDetection()">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸</button>

<!-- ìŠ¤í¬ë¦° ë¦¬ë” í…ŒìŠ¤íŠ¸ìš© ìˆ¨ê²¨ì§„ ìš”ì†Œë“¤ -->
<div aria-live="polite" aria-atomic="true" class="sr-only" id="announcer"></div>
<div class="test-aria" id="testElement" tabindex="-1">í…ŒìŠ¤íŠ¸ ìš”ì†Œ</div>

<script>
let touchStartTime = 0;
let touchCount = 0;
let detectionScore = 0;

// 1. Media Queriesë¥¼ í†µí•œ ì ‘ê·¼ì„± ì„¤ì • ê°ì§€
function checkAccessibilityPreferences() {
  const checks = {
    reducedMotion: window.matchMedia('(prefers-reduced-motion: reduce)').matches,
    highContrast: window.matchMedia('(prefers-contrast: high)').matches,
    reducedTransparency: window.matchMedia('(prefers-reduced-transparency: reduce)').matches,
    reducedData: window.matchMedia('(prefers-reduced-data: reduce)').matches
  };

  let score = 0;
  if (checks.reducedMotion) score += 25;
  if (checks.highContrast) score += 20;
  if (checks.reducedTransparency) score += 15;
  if (checks.reducedData) score += 10;

  return {
    checks,
    score
  };
}

// 2. Speech Synthesis API ì¢…í•© ë¶„ì„
function analyzeSpeechSynthesis() {
  if (!window.speechSynthesis) {
    return {
      available: false,
      score: 0,
      details: {}
    };
  }

  const synthesis = window.speechSynthesis;
  const voices = synthesis.getVoices();

  const details = {
    speaking: synthesis.speaking,
    pending: synthesis.pending,
    paused: synthesis.paused,
    voiceCount: voices.length,
    hasLocalVoices: voices.some(voice => voice.localService),
    hasSystemVoices: voices.some(voice => voice.name.includes('System') || voice.name.includes('Samsung') || voice.name.includes('Apple'))
  };

  let score = 0;
  if (details.speaking) score += 30;
  if (details.pending) score += 20;
  if (details.voiceCount > 10) score += 15;
  if (details.hasSystemVoices) score += 25;

  return {
    available: true,
    score,
    details
  };
}

// 3. ì‚¬ìš©ì ì—ì´ì „íŠ¸ ë° í”Œë«í¼ ë¶„ì„
function analyzeUserAgent() {
  const ua = navigator.userAgent.toLowerCase();
  const platform = navigator.platform.toLowerCase();

  const indicators = {
    isMobile: /mobile|android|iphone|ipad|ipod/.test(ua),
    isAndroid: /android/.test(ua),
    isIOS: /iphone|ipad|ipod/.test(ua),
    hasTalkback: /talkback/.test(ua),
    hasVoiceOver: /voiceover/.test(ua),
    hasAccessibility: /accessibility|a11y/.test(ua)
  };

  let score = 0;
  if (indicators.hasTalkback || indicators.hasVoiceOver) score += 50;
  if (indicators.hasAccessibility) score += 30;
  if (indicators.isMobile) score += 10;

  return {
    indicators,
    score
  };
}

// 4. í„°ì¹˜ íŒ¨í„´ ë¶„ì„
function analyzeTouchPatterns() {
  // ìŠ¤í¬ë¦° ë¦¬ë” ì‚¬ìš©ìì˜ íŠ¹ë³„í•œ í„°ì¹˜ íŒ¨í„´ ê°ì§€
  let score = 0;

  // ì§§ì€ ì‹œê°„ ë‚´ ì—°ì† í„°ì¹˜ (ë”ë¸” íƒ­)
  if (touchCount > 1 && Date.now() - touchStartTime < 500) {
    score += 20;
  }

  return {
    score,
    touchCount,
    lastTouchTime: touchStartTime
  };
}

// 5. í¬ì»¤ìŠ¤ ë° ì ‘ê·¼ì„± API í…ŒìŠ¤íŠ¸
function testAccessibilityFeatures() {
  let score = 0;
  const results = {};

  // Documentì— ì ‘ê·¼ì„± ê´€ë ¨ ì†ì„±ì´ ìˆëŠ”ì§€ í™•ì¸
  if (document.documentElement.hasAttribute('role')) score += 10;
  if (document.querySelector('[aria-live]')) score += 15;

  // í¬ì»¤ìŠ¤ ê´€ë¦¬ í…ŒìŠ¤íŠ¸
  try {
    const testElement = document.getElementById('testElement');
    if (testElement) {
      testElement.focus();
      if (document.activeElement === testElement) {
        score += 10;
        results.focusManagement = true;
      }
    }
  } catch (e) {
    // í¬ì»¤ìŠ¤ ì„¤ì • ì‹¤íŒ¨
  }

  return {
    score,
    results
  };
}

// 6. ì¢…í•© ê°ì§€ í•¨ìˆ˜
function detectScreenReader() {
  detectionScore = 0;
  const results = {};

  // ê° í…ŒìŠ¤íŠ¸ ì‹¤í–‰
  results.accessibility = checkAccessibilityPreferences();
  results.speechSynthesis = analyzeSpeechSynthesis();
  results.userAgent = analyzeUserAgent();
  results.touchPatterns = analyzeTouchPatterns();
  results.accessibilityFeatures = testAccessibilityFeatures();

  // ì´ ì ìˆ˜ ê³„ì‚°
  detectionScore =
    results.accessibility.score +
    results.speechSynthesis.score +
    results.userAgent.score +
    results.touchPatterns.score +
    results.accessibilityFeatures.score;

  return {
    detectionScore,
    results
  };
}

// ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
function displayResults(detection) {
  const console = document.getElementById('console');
  const {
    detectionScore,
    results
  } = detection;

  let status = '';
  let confidence = '';

  if (detectionScore >= 70) {
    status = 'ğŸŸ¢ ìŠ¤í¬ë¦° ë¦¬ë”ê°€ í™œì„±í™”ë˜ì–´ ìˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤';
    confidence = 'ë†’ìŒ';
  } else if (detectionScore >= 40) {
    status = 'ğŸŸ¡ ìŠ¤í¬ë¦° ë¦¬ë”ê°€ í™œì„±í™”ë˜ì–´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤';
    confidence = 'ì¤‘ê°„';
  } else {
    status = 'ğŸ”´ ìŠ¤í¬ë¦° ë¦¬ë”ê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤';
    confidence = 'ë‚®ìŒ';
  }

  const html = `
    <h3>${status}</h3>
    <p><span class="score">ê°ì§€ ì ìˆ˜: ${detectionScore}/200</span> (ì‹ ë¢°ë„: ${confidence})</p>
    
    <h4>ìƒì„¸ ë¶„ì„:</h4>
    <ul>
      <li><strong>ì ‘ê·¼ì„± ì„¤ì •:</strong> ${results.accessibility.score}ì 
        <br>â€¢ ì›€ì§ì„ ê°ì†Œ: ${results.accessibility.checks.reducedMotion ? 'âœ“' : 'âœ—'}
        <br>â€¢ ê³ ëŒ€ë¹„: ${results.accessibility.checks.highContrast ? 'âœ“' : 'âœ—'}
        <br>â€¢ íˆ¬ëª…ë„ ê°ì†Œ: ${results.accessibility.checks.reducedTransparency ? 'âœ“' : 'âœ—'}
      </li>
      
      <li><strong>ìŒì„± í•©ì„± API:</strong> ${results.speechSynthesis.score}ì 
        <br>â€¢ ì‚¬ìš© ê°€ëŠ¥: ${results.speechSynthesis.available ? 'âœ“' : 'âœ—'}
        ${results.speechSynthesis.available ? `
        <br>â€¢ í˜„ì¬ ë§í•˜ëŠ” ì¤‘: ${results.speechSynthesis.details.speaking ? 'âœ“' : 'âœ—'}
        <br>â€¢ ìŒì„± ê°œìˆ˜: ${results.speechSynthesis.details.voiceCount}ê°œ
        <br>â€¢ ì‹œìŠ¤í…œ ìŒì„±: ${results.speechSynthesis.details.hasSystemVoices ? 'âœ“' : 'âœ—'}
        ` : ''}
      </li>
      
      <li><strong>ì‚¬ìš©ì ì—ì´ì „íŠ¸:</strong> ${results.userAgent.score}ì 
        <br>â€¢ ëª¨ë°”ì¼: ${results.userAgent.indicators.isMobile ? 'âœ“' : 'âœ—'}
        <br>â€¢ Android: ${results.userAgent.indicators.isAndroid ? 'âœ“' : 'âœ—'}
        <br>â€¢ iOS: ${results.userAgent.indicators.isIOS ? 'âœ“' : 'âœ—'}
        <br>â€¢ í† í¬ë°±/ë³´ì´ìŠ¤ì˜¤ë²„ íŒíŠ¸: ${results.userAgent.indicators.hasTalkback || results.userAgent.indicators.hasVoiceOver ? 'âœ“' : 'âœ—'}
      </li>
      
      <li><strong>í„°ì¹˜ íŒ¨í„´:</strong> ${results.touchPatterns.score}ì 
        <br>â€¢ í„°ì¹˜ íšŸìˆ˜: ${results.touchPatterns.touchCount}íšŒ
      </li>
      
      <li><strong>ì ‘ê·¼ì„± ê¸°ëŠ¥:</strong> ${results.accessibilityFeatures.score}ì </li>
    </ul>
    
    <p><small>ğŸ’¡ ë” ì •í™•í•œ ê°ì§€ë¥¼ ìœ„í•´ í™”ë©´ì„ ì—¬ëŸ¬ ë²ˆ í„°ì¹˜í•´ë³´ì„¸ìš”.</small></p>
  `;

  console.innerHTML = html;
}

// ì „ì²´ ê°ì§€ ì‹¤í–‰
function runFullDetection() {
  const detection = detectScreenReader();
  displayResults(detection);

  // aria-liveë¡œ ê²°ê³¼ ì•ˆë‚´
  const announcer = document.getElementById('announcer');
  if (detection.detectionScore >= 70) {
    announcer.textContent = 'ìŠ¤í¬ë¦° ë¦¬ë”ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.';
  } else {
    announcer.textContent = 'ìŠ¤í¬ë¦° ë¦¬ë” ê°ì§€ í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
  }
}

// í„°ì¹˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
document.addEventListener('touchstart', function(e) {
  const currentTime = Date.now();
  if (currentTime - touchStartTime < 1000) {
    touchCount++;
  } else {
    touchCount = 1;
  }
  touchStartTime = currentTime;

  // í„°ì¹˜í•  ë•Œë§ˆë‹¤ ì¬ê°ì§€
  setTimeout(runFullDetection, 100);
});

// í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ë°ìŠ¤í¬í†± í…ŒìŠ¤íŠ¸ìš©)
document.addEventListener('click', function(e) {
  touchCount++;
  runFullDetection();
});

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ê°ì§€
window.addEventListener('load', function() {
  // Speech Synthesis APIê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ì ì‹œ ëŒ€ê¸°
  setTimeout(runFullDetection, 1000);
});

// ìŒì„± ëª©ë¡ì´ ë³€ê²½ë  ë•Œ ì¬ê°ì§€
if (window.speechSynthesis) {
  window.speechSynthesis.addEventListener('voiceschanged', runFullDetection);
}
</script>
</body>
</html>