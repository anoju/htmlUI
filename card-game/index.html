<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ì¹´ë“œ ì§ ì°¾ê¸° ê²Œì„</title>
  <meta name="viewport" content="width=770">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
      .card {
          perspective: 1000px;
          transition: transform 0.3s;
          transform-style: preserve-3d;
      }
      .card.flipped {
          transform: rotateY(180deg);
      }
      .card-front, .card-back {
          position: absolute;
          width: 100%;
          height: 100%;
          backface-visibility: hidden;
      }
      .card-back {
          transform: rotateY(180deg);
      }
      .card[data-suit="â™¥"] .card-back,
      .card[data-suit="â™¦"] .card-back{
          color: #EF4444;
      }
      .card-timer{
        pointer-events: none;
        position:sticky;
        top:10px;
        background:rgba(255,255,255,0.8);
        z-index:1;
      }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-purple-100 min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <!-- ê²Œì„ ì œëª© -->
    <h1 class="text-4xl font-bold text-center mb-8 text-blue-800">ì¹´ë“œ ì§ ì°¾ê¸° ê²Œì„</h1>

    <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
    <div class="bg-white rounded-lg shadow-lg p-6 max-w-2xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">í–‰:</label>
          <input type="number" id="rows" min="2" max="6" value="4"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">ì—´:</label>
          <input type="number" id="cols" min="2" max="9" value="6"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700">ì‹œê°„(ì´ˆ):</label>
          <input type="number" id="timer" min="30" max="300" value="60"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div class="flex items-end">
          <button id="start"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-200 ease-in-out transform hover:scale-105">
            ê²Œì„ ì‹œì‘
          </button>
        </div>
      </div>
    </div>

    <p class="text-center my-4">â€» í–‰ x ì—´ì˜ ê°’ì´ ì§ìˆ˜ì—¬ì•¼í•˜ë©°, 54(ìµœëŒ€ìˆ˜)ë¥¼ ë„˜ì–´ê°€ë©´ ì•ˆë©ë‹ˆë‹¤. </p>

    <div id="cardGame"></div>
  </div>

<script>
  class MemoryGame {
    constructor(targetElement, options = {}) {
      this.target = targetElement;
      if(!this.target) return;

      //ë””í´íŠ¸ ì˜µì…˜
      this.defaultOptions = {
        rows: 4,
        cols: 4,
        timeLimit: 120,
      };

      // ì˜µì…˜ ë³‘í•©
      this.finalOptions = {...this.defaultOptions, ...options};

      this.cards = [];
      this.timer = null;
      this.timerEl = null;
      this.remainingTime = this.finalOptions.timeLimit;
      this.flippedCards = [];
      this.matchedPairs = 0;
      this.cardListeners = new Map(); // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ì ì„ ìœ„í•œ Map
      
      this.init();
    }

    init() {
      const totalCards = this.finalOptions.rows * this.finalOptions.cols;
      if (totalCards > 54 || totalCards % 2 !== 0) {
          alert("ì¹´ë“œ ìˆ˜ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì§ìˆ˜ì—¬ì•¼ í•˜ë©° 54ì¥ì„ ë„˜ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          this.
          return;
      }

      this.resetGame();
      const deck = this.createDeck(totalCards / 2);
      this.cards = this.shuffleCards(deck);
      this.renderBoard();
      this.startTimer();
    }

    resetGame() {
      this.matchedPairs = 0;
      this.flippedCards = [];
      this.remainingTime = this.finalOptions.timeLimit;
      if (this.timer) clearInterval(this.timer);
      this.target.innerHTML = '';
    }

    cleanup() {
      // íƒ€ì´ë¨¸ ì •ë¦¬
      if (this.timer) {
        clearInterval(this.timer);
      }

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
      this.cardListeners.forEach((listener, element) => {
        element.removeEventListener('click', listener);
      });
      this.cardListeners.clear();

      // DOM ìš”ì†Œ ì •ë¦¬
      this.target.innerHTML = '';
    }

    createDeck(pairCount) {
      const suits = ['â™ ', 'â™¥', 'â™£', 'â™¦'];
      const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
      let allCards = [];
      
      // ëª¨ë“  ê°€ëŠ¥í•œ ì¹´ë“œ ì¡°í•© ìƒì„±
      for (let suit of suits) {
        for (let rank of ranks) {
          allCards.push({
            suit: suit,
            rank: rank,
            display: `${suit}${rank}`
          });
        }
      }
      
      // ì¡°ì»¤ ì¶”ê°€
      allCards.push({ suit: 'ğŸƒ', rank: '1', display: 'ğŸƒ1' });
      allCards.push({ suit: 'ğŸƒ', rank: '2', display: 'ğŸƒ2' });
      
      // ì¹´ë“œë¥¼ ì„ê³  í•„ìš”í•œ ë§Œí¼ë§Œ ì„ íƒ
      allCards = this.shuffleCards(allCards).slice(0, pairCount);
      
      // ê° ì¹´ë“œì˜ ìŒì„ ë§Œë“¤ì–´ ë°˜í™˜
      let pairedCards = [];
      allCards.forEach(card => {
        pairedCards.push({...card}, {...card});
      });
      
      return pairedCards;
    }

    shuffleCards(cards) {
      for (let i = cards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [cards[i], cards[j]] = [cards[j], cards[i]];
      }
      return cards;
    }

    renderBoard() {
      const timerEl  = document.createElement('div');
      timerEl.className = 'card-timer text-2xl font-bold text-center mb-8 text-blue-800 rounded-lg shadow-md py-3 max-w-xs mx-auto';
      timerEl.textContent = `ë‚¨ì€ ì‹œê°„: ${this.finalOptions.timeLimit}ì´ˆ`;
      this.target.appendChild(timerEl);
      this.timerEl = timerEl;

      const container = document.createElement('div');
      container.className = 'grid gap-4 justify-center mx-auto p-4 bg-white/50 rounded-xl shadow-xl max-w-6xl';
      container.style.gridTemplateColumns = `repeat(${this.finalOptions.cols}, minmax(100px, 1fr))`;
      
      this.cards.forEach((card, index) => {
        const cardElement = document.createElement('div');
        cardElement.className = 'card aspect-[2/3] relative cursor-pointer';
        cardElement.dataset.index = index;
        cardElement.dataset.suit = card.suit;
        cardElement.dataset.rank = card.rank;

        const frontFace = document.createElement('div');
        frontFace.className = 'card-front absolute w-full h-full bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center text-white text-3xl font-bold shadow-md';
        frontFace.textContent = '?';

        const backFace = document.createElement('div');
        backFace.className = 'card-back absolute w-full h-full bg-white rounded-xl flex items-center justify-center text-4xl font-bold shadow-md border-2 border-blue-200';
        backFace.textContent = card.display;

        cardElement.appendChild(frontFace);
        cardElement.appendChild(backFace);
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ì ì„ ìœ„í•´ Mapì— ì €ì¥
        const listener = () => this.flipCard(cardElement, card);
        this.cardListeners.set(cardElement, listener);
        cardElement.addEventListener('click', listener);
        
        container.appendChild(cardElement);
      });
      this.target.appendChild(container);
    }

    flipCard(cardElement, card) {
      if (
        cardElement.classList.contains('flipped') ||
        cardElement.classList.contains('matched') ||
        this.flippedCards.length >= 2
      ) return;

      cardElement.classList.add('flipped');
      this.flippedCards.push({ element: cardElement, card: card });

      if (this.flippedCards.length === 2) {
        setTimeout(() => this.checkMatch(), 500);
      }
    }

    checkMatch() {
      const [card1, card2] = this.flippedCards;
      const isMatch = card1.card.suit === card2.card.suit && card1.card.rank === card2.card.rank;

      if (isMatch) {
        card1.element.classList.add('matched');
        card1.element.querySelector('.card-back').classList.add('bg-green-100');
        card2.element.classList.add('matched');
        card2.element.querySelector('.card-back').classList.add('bg-green-100');
        this.matchedPairs++;

        if (this.matchedPairs === this.cards.length / 2) {
          this.endGame('ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ì¹´ë“œë¥¼ ë§ì¶”ì…¨ìŠµë‹ˆë‹¤!');
        }
      } else {
        card1.element.classList.remove('flipped');
        card2.element.classList.remove('flipped');
      }

      this.flippedCards = [];
    }

    startTimer() {
      this.timer = setInterval(() => {
        this.remainingTime--;
        this.timerEl.textContent = `ë‚¨ì€ ì‹œê°„: ${this.remainingTime}ì´ˆ`;
            
        if (this.remainingTime <= 0) {
          this.endGame('ì‹œê°„ ì´ˆê³¼!');
        }
      }, 1000);
    }

    endGame(message) {
      this.cleanup();
      alert(message);
    }
  };


  let currentGame = null; // í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ê²Œì„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¶”ì 
  document.getElementById('start').addEventListener('click', () => {
    // ê¸°ì¡´ ê²Œì„ì´ ìˆë‹¤ë©´ ì •ë¦¬
    if (currentGame) currentGame.cleanup();
    
    const rows = parseInt(document.getElementById('rows').value);
    const cols = parseInt(document.getElementById('cols').value);
    const timeLimit = parseInt(document.getElementById('timer').value);
    
    const gameEl = document.getElementById('cardGame');
    const gameOption = {
      rows: rows,
      cols: cols,
      timeLimit: timeLimit,
    };
    currentGame = new MemoryGame(gameEl, gameOption);
  });
</script>
</body>
</html>